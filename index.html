<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Máquina - Teoria da Computação</title>
    <style>
        /* --- ESTILOS (CSS) --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            padding-top: 30px;
            color: #333;
            padding-bottom: 50px;
        }

        .container {
            background-color: white;
            width: 700px;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            font-size: 1.5rem;
            margin-bottom: 20px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        h2 {
            font-size: 1.2rem;
            color: #2980b9;
            margin-top: 0;
            margin-bottom: 15px;
        }

        .step-container {
            display: none; /* Escondido por padrão */
            animation: fadeIn 0.5s;
        }

        .step-container.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .section-title {
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            margin-top: 20px;
            margin-bottom: 10px;
            font-weight: bold;
            color: #7f8c8d;
            font-size: 0.95rem;
            text-transform: uppercase;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        input[type="number"], select, input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
            box-sizing: border-box;
            background-color: white;
        }
        
        .row-form {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        .row-form > div {
            flex: 1;
        }

        /* Estilos para Checkboxes (Passo 1) */
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .checkbox-item {
            background-color: #ecf0f1;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            user-select: none;
            font-size: 0.9rem;
        }

        .checkbox-item input {
            margin-right: 8px;
        }

        /* Estilos para Seleção de Funções (Passo 2) */
        .registro-config-row {
            background-color: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }

        .registro-label {
            font-weight: bold;
            color: #e67e22;
            font-size: 1.1rem;
            width: 100%;
            margin-bottom: 5px;
        }

        .select-group {
            flex: 1;
            min-width: 200px;
        }

        /* Botões */
        .btn-action {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 12px 20px;
            width: 100%;
            font-size: 1rem;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
            font-weight: bold;
        }

        .btn-action:hover {
            background-color: #2ecc71;
        }

        .btn-add-inst {
            background-color: #3498db;
            margin-top: 0;
            padding: 10px 15px;
        }

        .btn-add-inst:hover {
            background-color: #5dade2;
        }

        .btn-secondary {
            background-color: #95a5a6;
            margin-top: 10px;
        }
        .btn-secondary:hover {
            background-color: #7f8c8d;
        }

        /* Área de Programa (Passo 3) */
        #program-list {
            list-style: none;
            padding: 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            min-height: 100px;
            margin-bottom: 20px;
        }
        #program-list li {
            padding: 10px 15px;
            border-bottom: 1px dashed #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Courier New', Courier, monospace;
        }
        #program-list li:last-child {
            border-bottom: none;
        }
        .inst-label {
            font-weight: bold;
            color: #e67e22;
            margin-right: 10px;
        }
        .btn-remove {
            background: none;
            border: none;
            color: #e74c3c;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
            line-height: 1;
        }

        .inst-error {
            color: #e74c3c;
            font-size: 0.85rem;
            margin-top: 5px;
        }

        /* Área de Resultado Final */
        #resultado-final {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap;
            font-size: 0.9rem;
            line-height: 1.5;
            border: 2px solid #34495e;
        }

        .error {
            color: #e74c3c;
            font-size: 0.85rem;
            display: none;
            margin-top: 5px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Simulador de Máquina de Registradores</h1>

        <!-- PASSO 1: Configuração Básica -->
        <div id="step-1" class="step-container active">
            <h2>Passo 1: Estrutura e Registradores</h2>
            
            <div class="form-group">
                <label for="qtdRegistradores">Quantidade de Registradores (1-16):</label>
                <input type="number" id="qtdRegistradores" min="1" max="16" placeholder="Ex: 2">
                <div id="error-qtd" class="error">Por favor, insira um valor entre 1 e 16.</div>
            </div>

            <div id="area-selecao-regs" style="display: none;">
                <div class="section-title">Registradores de Entrada</div>
                <div class="checkbox-group" id="container-entrada"></div>

                <div class="section-title">Registradores de Saída</div>
                <div class="checkbox-group" id="container-saida"></div>

                <button class="btn-action" onclick="irParaPasso2()">Próximo: Definir Operações</button>
            </div>
        </div>

        <!-- PASSO 2: Operações e Testes -->
        <div id="step-2" class="step-container">
            <h2>Passo 2: Funções e Testes</h2>
            <p style="font-size: 0.9rem; color: #666;">Defina a operação e o teste padrão para cada registrador.</p>
            
            <div id="container-funcoes">
                <!-- Linhas geradas dinamicamente -->
            </div>

            <div style="display: flex; gap: 10px;">
                <button class="btn-action btn-secondary" onclick="voltarParaPasso1()" style="width: 30%;">Voltar</button>
                <button class="btn-action" onclick="irParaPasso3()">Próximo: Definir Programa</button>
            </div>
        </div>
        
        <!-- PASSO 3: Definição do Programa -->
        <div id="step-3" class="step-container">
            <h2>Passo 3: Definição do Programa Monolítico</h2>
            
            <div class="section-title">Instruções do Programa</div>
            <ul id="program-list">
                <!-- Instruções serão adicionadas aqui -->
            </ul>

            <div class="section-title">Adicionar Nova Instrução</div>
            <div class="row-form">
                <div style="max-width: 80px;">
                    <label for="inst-label">Rótulo</label>
                    <input type="number" id="inst-label" min="1" placeholder="Ex: 1">
                </div>
                <div>
                    <label for="inst-type">Tipo</label>
                    <select id="inst-type" onchange="toggleLabelInputs()">
                        <option value="T">Teste (Se... Então... Senão...)</option>
                        <option value="O">Operação (Faça...)</option>
                    </select>
                </div>
                <div>
                    <label for="inst-reg">Registrador Alvo</label>
                    <select id="inst-reg">
                        <!-- Opções preenchidas pelo JS -->
                    </select>
                </div>
            </div>

            <div class="row-form" id="label-inputs">
                <!-- Campos de Rótulo de Destino (Varia entre O e T) -->
            </div>
            
            <div id="inst-error" class="inst-error"></div>

            <button class="btn-action btn-add-inst" onclick="addInstruction()">Adicionar Instrução</button>

            <div style="display: flex; gap: 10px; margin-top: 30px;">
                <button class="btn-action btn-secondary" onclick="voltarParaPasso2()" style="width: 30%;">Voltar</button>
                <button class="btn-action" onclick="gerarMaquinaFinal()">Finalizar e Simular</button>
            </div>
        </div>

        <!-- RESULTADO FINAL -->
        <div id="step-result" class="step-container">
            <h2>Máquina e Programa Definidos</h2>
            <p>Abaixo está a representação textual formal da sua máquina e programa:</p>
            <div id="resultado-final"></div>
            <button class="btn-action" onclick="location.reload()">Criar Nova Máquina</button>
        </div>

    </div>

    <script>
        /* --- VARIÁVEIS GLOBAIS --- */
        let maquinaConfig = {
            qtd: 0,
            entrada: [],
            saida: [],
            operacoes: {}, // { 'A': { val: 'inc', text: 'Incremento (++)' }, ... }
            testes: {}     // { 'A': { val: 'zero', text: 'Igual a 0 (= 0)' }, ... }
        };
        let programa = []; // Armazena as instruções do programa

        /* --- CONSTANTES DE OPÇÕES --- */
        const OPCOES_OPERACOES = [
            { val: 'add', text: 'Soma (+)' }, { val: 'sub', text: 'Subtração (-)' },
            { val: 'mult', text: 'Multiplicação (*)' }, { val: 'div', text: 'Divisão (/)' },
            { val: 'mod', text: 'Módulo (%)' }, { val: 'inc', text: 'Incremento (++)' },
            { val: 'dec', text: 'Decremento (--)' }
        ];

        const OPCOES_TESTES = [
            { val: 'zero', text: 'Igual a 0 (= 0)' }, { val: 'gt0', text: 'Maior que 0 (> 0)' },
            { val: 'lt0', text: 'Menor que 0 (< 0)' }, { val: 'gte0', text: 'Maior ou Igual a 0 (>= 0)' },
            { val: 'lte0', text: 'Menor ou Igual a 0 (<= 0)' }, { val: 'neq0', text: 'Diferente de 0 (!= 0)' }
        ];

        /* --- ELEMENTOS DOM --- */
        const step1 = document.getElementById('step-1');
        const step2 = document.getElementById('step-2');
        const step3 = document.getElementById('step-3');
        const stepResult = document.getElementById('step-result');
        const inputQtd = document.getElementById('qtdRegistradores');
        
        /* --- PASSO 1 LÓGICA --- */
        // ... (Mesma lógica do passo 1) ...
        inputQtd.addEventListener('input', function() {
            const qtd = parseInt(this.value);
            const errorDiv = document.getElementById('error-qtd');
            const areaSelecao = document.getElementById('area-selecao-regs');

            if (isNaN(qtd) || qtd < 1 || qtd > 16) {
                errorDiv.style.display = 'block';
                areaSelecao.style.display = 'none';
            } else {
                errorDiv.style.display = 'none';
                areaSelecao.style.display = 'block';
                gerarCheckboxes(qtd);
            }
        });

        function gerarCheckboxes(qtd) {
            const containerEntrada = document.getElementById('container-entrada');
            const containerSaida = document.getElementById('container-saida');
            containerEntrada.innerHTML = '';
            containerSaida.innerHTML = '';

            for (let i = 0; i < qtd; i++) {
                const letra = String.fromCharCode(65 + i);
                containerEntrada.appendChild(criarCheckbox(letra, 'entrada'));
                containerSaida.appendChild(criarCheckbox(letra, 'saida'));
            }
        }

        function criarCheckbox(letra, grupo) {
            const label = document.createElement('label');
            label.className = 'checkbox-item';
            label.innerHTML = `<input type="checkbox" name="${grupo}" value="${letra}"> Reg. ${letra}`;
            return label;
        }

        /* --- PASSO 2 LÓGICA --- */

        function irParaPasso2() {
            const qtd = parseInt(inputQtd.value);
            const entradas = Array.from(document.querySelectorAll('input[name="entrada"]:checked')).map(cb => cb.value);
            const saidas = Array.from(document.querySelectorAll('input[name="saida"]:checked')).map(cb => cb.value);

            // Salva no objeto global
            maquinaConfig.qtd = qtd;
            maquinaConfig.entrada = entradas;
            maquinaConfig.saida = saidas;
            maquinaConfig.operacoes = {};
            maquinaConfig.testes = {};

            // Gera interface do passo 2
            gerarInterfaceFuncoes(qtd);

            // Troca de tela
            step1.classList.remove('active');
            step2.classList.add('active');
        }

        function gerarInterfaceFuncoes(qtd) {
            const container = document.getElementById('container-funcoes');
            container.innerHTML = '';

            for (let i = 0; i < qtd; i++) {
                const letra = String.fromCharCode(65 + i);
                
                const row = document.createElement('div');
                row.className = 'registro-config-row';

                // Label
                const label = document.createElement('div');
                label.className = 'registro-label';
                label.innerText = `Registrador ${letra}`;
                row.appendChild(label);

                // Select Operação
                const groupOp = document.createElement('div');
                groupOp.className = 'select-group';
                const labelOp = document.createElement('label');
                labelOp.innerText = "Operação:";
                const selOp = document.createElement('select');
                selOp.id = `op_${letra}`;
                OPCOES_OPERACOES.forEach(opt => {
                    selOp.innerHTML += `<option value="${opt.val}">${opt.text}</option>`;
                });
                groupOp.appendChild(labelOp);
                groupOp.appendChild(selOp);
                row.appendChild(groupOp);

                // Select Teste
                const groupTest = document.createElement('div');
                groupTest.className = 'select-group';
                const labelTest = document.createElement('label');
                labelTest.innerText = "Teste Lógico:";
                const selTest = document.createElement('select');
                selTest.id = `test_${letra}`;
                OPCOES_TESTES.forEach(opt => {
                    selTest.innerHTML += `<option value="${opt.val}">${opt.text}</option>`;
                });
                groupTest.appendChild(labelTest);
                groupTest.appendChild(selTest);
                row.appendChild(groupTest);

                container.appendChild(row);
            }
        }

        function voltarParaPasso1() {
            step2.classList.remove('active');
            step1.classList.add('active');
        }

        /* --- PASSO 3 LÓGICA (Definição do Programa) --- */

        function irParaPasso3() {
            // 1. Captura e Salva Funções
            for (let i = 0; i < maquinaConfig.qtd; i++) {
                const letra = String.fromCharCode(65 + i);
                const opSelect = document.getElementById(`op_${letra}`);
                const testSelect = document.getElementById(`test_${letra}`);

                maquinaConfig.operacoes[letra] = {
                    val: opSelect.value, 
                    text: opSelect.options[opSelect.selectedIndex].text,
                    funcName: mapearNomeOperacao(opSelect.value, letra)
                };
                maquinaConfig.testes[letra] = {
                    val: testSelect.value, 
                    text: testSelect.options[testSelect.selectedIndex].text,
                    funcName: mapearNomeTeste(testSelect.value, letra)
                };
            }

            // 2. Preenche Registradores disponíveis para Programação
            const instRegSelect = document.getElementById('inst-reg');
            instRegSelect.innerHTML = '';
            for (let i = 0; i < maquinaConfig.qtd; i++) {
                const letra = String.fromCharCode(65 + i);
                instRegSelect.innerHTML += `<option value="${letra}">${letra}</option>`;
            }
            
            // 3. Renderiza a parte de rótulos (padrão é Teste)
            toggleLabelInputs();

            // 4. Troca de tela
            step2.classList.remove('active');
            step3.classList.add('active');
        }

        function voltarParaPasso2() {
            step3.classList.remove('active');
            step2.classList.add('active');
        }

        function toggleLabelInputs() {
            const type = document.getElementById('inst-type').value;
            const labelInputsDiv = document.getElementById('label-inputs');
            
            if (type === 'T') { // Teste
                labelInputsDiv.innerHTML = `
                    <div class="row-form">
                        <div>
                            <label for="inst-dest-false">Rótulo Destino (Senão/Falso)</label>
                            <input type="number" id="inst-dest-false" min="1" placeholder="Ex: 2">
                        </div>
                        <div>
                            <label for="inst-dest-true">Rótulo Destino (Então/Verdadeiro)</label>
                            <input type="number" id="inst-dest-true" min="1" placeholder="Ex: 9">
                        </div>
                    </div>
                `;
            } else { // Operação
                labelInputsDiv.innerHTML = `
                    <div class="row-form">
                        <div>
                            <label for="inst-dest-op">Rótulo Destino (Próxima)</label>
                            <input type="number" id="inst-dest-op" min="1" placeholder="Ex: 3">
                        </div>
                    </div>
                `;
            }
        }

        function addInstruction() {
            const instError = document.getElementById('inst-error');
            instError.innerText = '';

            const label = parseInt(document.getElementById('inst-label').value);
            const type = document.getElementById('inst-type').value;
            const reg = document.getElementById('inst-reg').value;
            
            if (isNaN(label) || label < 1) {
                instError.innerText = "Rótulo inválido. Deve ser um número inteiro positivo.";
                return;
            }

            // Checa se o rótulo já existe
            if (programa.some(inst => inst.label === label)) {
                instError.innerText = `O rótulo ${label} já foi utilizado. Escolha outro.`;
                return;
            }

            let instruction = {
                label: label,
                type: type, // 'T' ou 'O'
                reg: reg
            };
            
            let dest1, dest2;

            if (type === 'T') {
                dest1 = parseInt(document.getElementById('inst-dest-false').value); // FALSO
                dest2 = parseInt(document.getElementById('inst-dest-true').value);  // VERDADEIRO

                if (isNaN(dest1) || isNaN(dest2) || dest1 < 1 || dest2 < 1) {
                    instError.innerText = "Rótulos de destino (Falso e Verdadeiro) devem ser números inteiros positivos.";
                    return;
                }
                
                instruction.destFalse = dest1;
                instruction.destTrue = dest2;
                instruction.action = maquinaConfig.testes[reg];

            } else { // Operação 'O'
                dest1 = parseInt(document.getElementById('inst-dest-op').value);

                if (isNaN(dest1) || dest1 < 1) {
                    instError.innerText = "Rótulo de destino deve ser um número inteiro positivo.";
                    return;
                }

                instruction.dest = dest1;
                instruction.action = maquinaConfig.operacoes[reg];
            }

            programa.push(instruction);
            // Ordena o programa por rótulo
            programa.sort((a, b) => a.label - b.label); 
            
            renderProgramList();
            
            // Limpa o formulário (deixa apenas o rótulo em branco)
            document.getElementById('inst-label').value = '';
            document.getElementById('inst-type').value = 'T';
            toggleLabelInputs(); // Reseta os campos de destino
            document.getElementById('inst-reg').selectedIndex = 0;
        }

        function removeInstruction(labelToRemove) {
            programa = programa.filter(inst => inst.label !== labelToRemove);
            renderProgramList();
        }

        function renderProgramList() {
            const ul = document.getElementById('program-list');
            ul.innerHTML = '';

            if (programa.length === 0) {
                ul.innerHTML = '<li style="justify-content: center; color: #888;">Nenhuma instrução adicionada.</li>';
                return;
            }

            programa.forEach(inst => {
                const li = document.createElement('li');
                
                let desc;
                if (inst.type === 'T') {
                    // Ex: 1: Se a_zero então vá_para 9 senão va_para 2
                    desc = `Se **${inst.action.funcName}** (Reg ${inst.reg}) então vá_para ${inst.destTrue} senão vá_para ${inst.destFalse}`;
                } else {
                    // Ex: 2: faça subtrai_a vá_para 3
                    desc = `Faça **${inst.action.funcName}** (Reg ${inst.reg}) vá_para ${inst.dest}`;
                }

                li.innerHTML = `
                    <span class="inst-label">${inst.label}:</span>
                    <span>${desc}</span>
                    <button class="btn-remove" onclick="removeInstruction(${inst.label})">✕</button>
                `;
                ul.appendChild(li);
            });
        }

        /* --- GERAÇÃO FINAL DO TEXTO (Passo 4) --- */
        
        function gerarMaquinaFinal() {
            // 1. Validação de Rótulos (Opcional, mas importante: HALT)
            const todosOsDestinos = programa.flatMap(inst => {
                if (inst.type === 'T') return [inst.destFalse, inst.destTrue];
                return [inst.dest];
            });

            const rotulosExistentes = new Set(programa.map(inst => inst.label));

            // Checar se o HALT (Rótulo 99, por exemplo) está sendo usado, ou se todos os
            // destinos levam a rótulos válidos. Vamos simplificar assumindo que qualquer rótulo
            // que não existe é o HALT, mas avisando o usuário.

            // 2. Montar Texto Formal (Máquina)
            const textoMaquina = construirTextoFormal();

            // 3. Montar Texto do Programa
            let textoPrograma = `\n\nPROGRAMA:\n`;
            
            if (programa.length === 0) {
                textoPrograma += "Nenhum programa definido. A máquina irá parar imediatamente.";
            } else {
                 programa.forEach(inst => {
                    if (inst.type === 'T') {
                        // Ex: 1: Se a_zero então vá_para 9 senão va_para 2
                        textoPrograma += `${inst.label}: Se ${inst.action.funcName} então vá_para ${inst.destTrue} senão vá_para ${inst.destFalse}\n`;
                    } else {
                        // Ex: 2: faça subtrai_a vá_para 3
                        textoPrograma += `${inst.label}: faça ${inst.action.funcName} vá_para ${inst.dest}\n`;
                    }
                });
            }
            
            document.getElementById('resultado-final').innerText = textoMaquina + textoPrograma;
            
            step3.classList.remove('active');
            stepResult.classList.add('active');
        }

        /* --- HELPER FUNCTIONS PARA O TEXTO FORMAL (REPETIÇÃO DO PASSO 2) --- */

        function mapearNomeOperacao(op, reg) {
            // Retorna nomes como 'adiciona_a', 'subtrai_b' baseados na seleção
            switch(op) {
                case 'add': return `adiciona_${reg.toLowerCase()}`;
                case 'sub': return `subtrai_${reg.toLowerCase()}`;
                case 'mult': return `multiplica_${reg.toLowerCase()}`;
                case 'div': return `divide_${reg.toLowerCase()}`;
                case 'mod': return `mod_${reg.toLowerCase()}`;
                case 'inc': return `inc_${reg.toLowerCase()}`;
                case 'dec': return `dec_${reg.toLowerCase()}`;
                default: return `op_${reg.toLowerCase()}`;
            }
        }

        function mapearNomeTeste(test, reg) {
            switch(test) {
                case 'zero': return `${reg.toLowerCase()}_zero`;
                case 'gt0': return `${reg.toLowerCase()}_maior_zero`;
                case 'lt0': return `${reg.toLowerCase()}_menor_zero`;
                case 'neq0': return `${reg.toLowerCase()}_dif_zero`;
                case 'gte0': return `${reg.toLowerCase()}_maior_igual_zero`;
                case 'lte0': return `${reg.toLowerCase()}_menor_igual_zero`;
                default: return `teste_${reg.toLowerCase()}`;
            }
        }

        function construirTextoFormal() {
            const qtd = maquinaConfig.qtd;
            const regsEntrada = maquinaConfig.entrada.length;
            const regsSaida = maquinaConfig.saida.length;
            
            // 1. Listas de funções para a tupla principal
            const listaOps = [];
            const listaTestes = [];
            
            for(let i=0; i<qtd; i++) {
                let l = String.fromCharCode(65+i);
                listaOps.push(maquinaConfig.operacoes[l].funcName);
                listaTestes.push(maquinaConfig.testes[l].funcName);
            }

            // 2. Montagem do Texto Principal
            let txt = `maquina_${qtd}regs = (N^${qtd}, N^${regsEntrada || 0}, N^${regsSaida || 0}, entrada_func, saida_func, (${listaOps.join(', ')}), (${listaTestes.join(', ')}))\n\n`;
            
            txt += `ONDE:\n`;
            txt += `\tN^${qtd} é o conjunto de valores de memória (registradores A..${String.fromCharCode(64+qtd)})\n`;
            txt += `\tN^${regsEntrada} é o conjunto de valores de entrada (${maquinaConfig.entrada.join(',')})\n`;
            txt += `\tN^${regsSaida} é o conjunto de valores de saída (${maquinaConfig.saida.join(',')})\n\n`;

            txt += `DEFINIÇÕES DE ENTRADA E SAÍDA:\n`;
            // Descrição genérica da entrada
            if (regsEntrada > 0) {
                const varsEntrada = maquinaConfig.entrada.map(r => r.toLowerCase()).join(',');
                const tuplaMemoria = Array.from({length: qtd}, (_, i) => {
                    let l = String.fromCharCode(65+i);
                    return maquinaConfig.entrada.includes(l) ? l.toLowerCase() : '0';
                }).join(',');
                
                txt += `\tentrada_func: N^${regsEntrada} -> N^${qtd}\n`;
                txt += `\tentrada_func(${varsEntrada}) = (${tuplaMemoria})\n\n`;
            } else {
                txt += `\tentrada_func: N/A (Sem registradores de entrada definidos)\n\n`;
            }

            // Descrição genérica da saída
            if (regsSaida > 0) {
                const varsMemoria = Array.from({length: qtd}, (_, i) => `n${i+1}`).join(',');
                const varsSaida = maquinaConfig.saida.map(r => {
                    let index = r.charCodeAt(0) - 65;
                    return `n${index+1}`;
                }).join(',');

                txt += `\tsaida_func: N^${qtd} -> N^${regsSaida}\n`;
                txt += `\tsaida_func(${varsMemoria}) = (${varsSaida})\n\n`;
            } else {
                txt += `\tsaida_func: N/A (Sem registradores de saída definidos)\n\n`;
            }

            txt += `INTERPRETAÇÕES (ESCOLHAS DO USUÁRIO):\n`;
            for(let i=0; i<qtd; i++) {
                let l = String.fromCharCode(65+i);
                
                // Operação
                txt += `\t${maquinaConfig.operacoes[l].funcName} (Op. em R[${l}]): \t${maquinaConfig.operacoes[l].text}\n`;
                
                // Teste
                txt += `\t${maquinaConfig.testes[l].funcName} (Teste em R[${l}]): \t${maquinaConfig.testes[l].text}\n`;
            }

            return txt;
        }

        // Garante que o estado inicial está correto ao carregar a página
        document.addEventListener('DOMContentLoaded', function() {
            toggleLabelInputs(); // Garante que a interface do Passo 3 está no estado inicial de Teste
            step1.classList.add('active'); // Garante que o Passo 1 é exibido
        });
    </script>
</body>
</html>